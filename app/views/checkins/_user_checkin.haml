.card
  .card-header
    %h2= user.username

  .card-block
    - @checkin.tasks.where(:user => user).group_by(&:current).each_pair do |current, tasks_by_current|

      %b= current ? 'What I did yesterday' : 'What I will do today'
      - tasks_by_current.group_by(&:project).each_pair do |project, tasks_by_project|
        %br= project.try(&:name)
        - tasks_by_project.each do |task|
          - estimate = (task.estimate == 0) ? 'Unestimated' : task.estimate
          - times_text = "#{(task.times_checked_in_current > 1) ? 'times checked in' : 'time checked in'}"
          - times_checkedin = !task.current ? "[#{task.times_checked_in_current} #{times_text}]" : ''
          = link_to "[#{task.task_type}][#{task.current_state}][#{estimate}]#{times_checkedin} #{task.title}", task.url
          %br
      %p= "Load: #{tasks_by_current.map(&:estimate).inject(0, &:+)}"

    - blockers = @checkin.blockers.where(:user => user).first
    - unless blockers.nil?
      %b Blockers
      %p= blockers.description

    - notes = @checkin.notes.where(:user => user).first
    - unless notes.nil?
      %b Notes
      %p= notes.description
